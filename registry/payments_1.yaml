product: payments
version: v1
namespace: telco.silver

entities:
  - name: payments
    table: payments
    primary_key: payment_id
    fields:
      - { name: payment_id, type: STRING }
      - { name: account_id, type: STRING }
      - { name: bill_id, type: STRING }
      - { name: amount, type: DECIMAL(18,2) }
      - { name: currency, type: STRING }
      - { name: method, type: STRING }
      - { name: status, type: STRING }
      - { name: created_at, type: TIMESTAMP }
      - { name: updated_at, type: TIMESTAMP }

  - name: bills
    table: bills
    primary_key: bill_id
    fields:
      - { name: bill_id, type: STRING }
      - { name: account_id, type: STRING }
      - { name: amount_due, type: DECIMAL(18,2) }
      - { name: status, type: STRING }
      - { name: bill_date, type: DATE }

relationships:
  - { from: bills, to: payments, type: "ONE_TO_MANY", via: bill_id }

expose:
  queries:
    - get_payment: { entity: payments, by_key: payment_id }
    - list_payments:
        entity: payments
        filters:
          - { name: account_id, type: STRING, operator: "=" }
          - { name: status,     type: STRING, operator: "=" }
          - { name: method,     type: STRING, operator: "=" }
          - { name: from_time,  type: TIMESTAMP, operator: ">=", column: "created_at" }
          - { name: to_time,    type: TIMESTAMP, operator: "<",  column: "created_at" }
        pagination: { default_limit: 50, max_limit: 500 }
        order_by_default: "-created_at"
    - get_bill: { entity: bills, by_key: bill_id }
    - list_bills:
        entity: bills
        filters:
          - { name: account_id, type: STRING, operator: "=" }
          - { name: status,     type: STRING, operator: "=" }
          - { name: from_date,  type: DATE, operator: ">=", column: "bill_date" }
          - { name: to_date,    type: DATE, operator: "<",  column: "bill_date" }
        pagination: { default_limit: 50, max_limit: 500 }
        order_by_default: "-bill_date"
